<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kinh Dịch AI</title>

  <!-- Supabase UMD v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: Arial; padding:40px; background:#f8f8f8 }
    input { display:block; margin:10px 0; padding:8px; width:250px }
    button { padding:8px 16px }
  </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">

// ✅ Lấy createClient từ global supabase UMD
const { createClient } = window.supabase;

// ✅ KHÔNG đặt tên trùng "supabase"
const supabaseClient = createClient(
  "https://qqadeyowwdslkkuesdxg.supabase.co",
  "sb_publishable_zoL3L3WvMp5svcenqJQ7ew_aexnJmK0"
);

const { useState, useEffect } = React;

function App() {
  const [user, setUser] = useState(null);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [message, setMessage] = useState("");

  useEffect(() => {
    checkSession();

    const { data: listener } =
      supabaseClient.auth.onAuthStateChange((_event, session) => {
        setUser(session?.user || null);
      });

    return () => listener.subscription.unsubscribe();
  }, []);

  async function checkSession() {
    const { data } = await supabaseClient.auth.getSession();
    setUser(data.session?.user || null);
  }

  async function login() {
    setMessage("");
    const { error } = await supabaseClient.auth.signInWithPassword({
      email,
      password,
    });

    if (error) setMessage(error.message);
    else setMessage("Đăng nhập thành công!");
  }

  async function logout() {
    await supabaseClient.auth.signOut();
    setUser(null);
  }

  if (!user) {
    return (
      <div>
        <h2>Đăng nhập Supabase</h2>
        <input
          type="email"
          placeholder="Email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
        />
        <input
          type="password"
          placeholder="Password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />
        <button onClick={login}>Đăng nhập</button>
        <p>{message}</p>
      </div>
    );
  }

  return (
    <div>
      <h2>Xin chào {user.email}</h2>
      <button onClick={logout}>Đăng xuất</button>
    </div>
  );
}

// React 18 chuẩn
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);

</script>

</body>
</html>
