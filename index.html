<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supabase Test</title>

  <!-- React 18 -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Supabase v2 UMD -->
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <style>
    body { font-family: Arial; padding:40px; }
    input { display:block; margin:10px 0; padding:8px; width:250px; }
    button { padding:8px 16px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    // ✅ Supabase client đúng chuẩn
    const { createClient } = supabase;

    const supabaseClient = createClient(
      "https://qqadeyowwdslkkuesdxg.supabase.co",
      "sb_publishable_zoL3L3WvMp5svcenqJQ7ew_aexnJmK0"
    );

    function App() {
      const [user, setUser] = useState(null);
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [message, setMessage] = useState("");

      useEffect(() => {
        checkSession();

        const { data: listener } = supabaseClient.auth.onAuthStateChange(
          (_event, session) => {
            setUser(session?.user || null);
          }
        );

        return () => listener.subscription.unsubscribe();
      }, []);

      async function checkSession() {
        const { data } = await supabaseClient.auth.getSession();
        setUser(data.session?.user || null);
      }

      async function login() {
        setMessage("");
        const { error } = await supabaseClient.auth.signInWithPassword({
          email,
          password
        });

        if (error) setMessage(error.message);
        else setMessage("Đăng nhập thành công!");
      }

      async function logout() {
        await supabaseClient.auth.signOut();
        setUser(null);
      }

      if (!user) {
        return React.createElement("div", null,
          React.createElement("h2", null, "Đăng nhập Supabase"),
          React.createElement("input", {
            type: "email",
            placeholder: "Email",
            value: email,
            onChange: e => setEmail(e.target.value)
          }),
          React.createElement("input", {
            type: "password",
            placeholder: "Password",
            value: password,
            onChange: e => setPassword(e.target.value)
          }),
          React.createElement("button", { onClick: login }, "Đăng nhập"),
          React.createElement("p", null, message)
        );
      }

      return React.createElement("div", null,
        React.createElement("h2", null, "Xin chào ", user.email),
        React.createElement("button", { onClick: logout }, "Đăng xuất")
      );
    }

    const root = createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
